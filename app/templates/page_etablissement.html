{% extends "base.html" %}
{% block content %}
<div class="container">
    <!-- Détails de l'établissement -->
    <div class="etablissement-header">
        <h1>{{ etablissement.nom | enlever_accents }}</h1>
        <p class="type-badge">{{ etablissement.type_etab.value }}</p>
        <div class="etablissement-info">
            <p><strong>Adresse :</strong> {{ etablissement.adresse }}, {{ etablissement.code_postal }} {{ etablissement.ville }}</p>
            {% if etablissement.telephone %}
                <p><strong>Téléphone :</strong> {{ etablissement.telephone }}</p>
            {% endif %}
            {% if etablissement.description %}
                <p class="description">{{ etablissement.description }}</p>
            {% endif %}
        </div>
    </div>

    <!-- Grille des flans -->
    <h2 class="section-title">Les flans</h2>
    {% if etablissement.flans %}
        <div class="flans-grid">
            {% for flan in etablissement.flans %}
            <div class="flan-card">
                {% if flan.photos %}
                    <img src="{{ url_for('static', filename='uploads/' + flan.photos[0].path) }}" alt="{{ flan.nom }}" class="card-image">
                {% else %}
                    <div class="card-image placeholder">
                        <span>Pas de photo</span>
                    </div>
                {% endif %}
                <div class="card-content">
                    <div class="flan-header">
                        <h3>{{ flan.nom  | enlever_accents  }}</h3>
                        {% if flan.prix is not none %}
                            <span class="flan-price">{{ "%.2f"|format(flan.prix) }} €</span>
                        {% else %}
                            <span class="flan-price">Prix non renseigné</span>
                        {% endif %}
                    </div>
                    <p class="flan-description">{{ flan.description or "Un flan flantastique" }}</p>
                    <div class="flan-actions">
                        <a href="{{ url_for('main.afficher_flan_unique', id_flan=flan.id_flan) }}" class="btn-details">Voir les détails</a>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="no-results">
            <p>Aucun flan propose pour cet établissement.</p>
        </div>
    {% endif %}

    <!-- Section pour ajouter un flan -->
    <div class="ajouter-flan-section">
        <h3>Ajouter un flan</h3>
        {% if current_user.is_authenticated %}
            <!-- Formulaire d'ajout de flan -->
            <form method="POST" action="{{ url_for('main.proposer_flan', id_etab=etablissement.id_etab) }}" class="form-container">

                {{ form.hidden_tag() }}
                <div class="form-group">
                    {{ form.nom.label(class="form-label") }}
                    {{ form.nom(class="form-control") }}
                    {% if form.nom.errors %}
                        <div class="error-message">{{ form.nom.errors[0] }}</div>
                    {% endif %}
                </div>
                <div class="form-group">
                    {{ form.description.label(class="form-label") }}
                    {{ form.description(class="form-control") }}
                    {% if form.description.errors %}
                        <div class="error-message">{{ form.description.errors[0] }}</div>
                    {% endif %}
                </div>
                <div class="form-group">
                    {{ form.prix.label(class="form-label") }}
                    {{ form.prix(class="form-control") }}
                    {% if form.prix.errors %}
                        <div class="error-message">{{ form.prix.errors[0] }}</div>
                    {% endif %}
                </div>
                <div class="form-group">
                    {{ form.submit(class="btn btn-proposer") }}
                </div>
            </form>
        {% else %}
            <!-- Bouton de connexion -->
            <a href="{{ url_for('auth.login', next=request.full_path) }}" class="btn-proposer">
                Ajouter un flan (connectez-vous)
            </a>
        {% endif %}
    </div>

    <!-- Bouton retour -->
    <a href="{{ url_for('main.rechercher') }}" class="btn-back">← Retour à la liste</a>
</div>
{% endblock %}
