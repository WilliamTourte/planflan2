{% extends "base.html" %}

{% block content %}
  <div class="container">
      <h1>Tableau de bord</h1>
      <div id="user-info" class="etablissement-header">
          <p><strong>Pseudo:</strong> {{ current_user.pseudo }}</p>
          <p><strong>Email:</strong> {{ current_user.email }}</p>
          <div style="text-align: right;">
              <button id="edit-profile-btn" class="btn btn-primary">Modifier le compte</button>
              <form method="POST" action="{{ url_for('auth.supprimer_compte') }}" style="display: inline-block;">
                  <button type="submit" class="btn btn-danger">Supprimer le compte</button>
              </form>
          </div>
      </div>

      <div id="edit-profile-form" style="display: none;">
          <form method="POST" action="" class="form">
              {{ form.hidden_tag() }}
              <div class="form-group">
                  {{ form.pseudo.label }}<br>
                  {{ form.pseudo(size=20, class="form-control") }}<br>
                  {% for error in form.pseudo.errors %}
                  <span class="error-message">[{{ error }}]</span>
                  {% endfor %}
              </div>
              <div class="form-group">
                  {{ form.email.label }}<br>
                  {{ form.email(size=20, class="form-control") }}<br>
                  {% for error in form.email.errors %}
                  <span class="error-message">[{{ error }}]</span>
                  {% endfor %}
              </div>
              <div class="form-group">
                  {{ form.current_password.label }}<br>
                  {{ form.current_password(size=20, class="form-control") }}<br>
                  {% for error in form.current_password.errors %}
                  <span class="error-message">[{{ error }}]</span>
                  {% endfor %}
              </div>
              <div class="form-group">
                  {{ form.new_password.label }}<br>
                  {{ form.new_password(size=20, class="form-control") }}<br>
                  {% for error in form.new_password.errors %}
                  <span class="error-message">[{{ error }}]</span>
                  {% endfor %}
              </div>
              <div class="form-group">
                  {{ form.confirm_password.label }}<br>
                  {{ form.confirm_password(size=20, class="form-control") }}<br>
                  {% for error in form.confirm_password.errors %}
                  <span class="error-message">[{{ error }}]</span>
                  {% endfor %}
              </div>
              <div class="form-group">
                  {{ form.submit(class="btn btn-submit") }}
              </div>
          </form>
      </div>

      <!-- Section des évaluations -->
      <div class="evaluations-section">
          <h2 class="evaluations-title">Mes evaluations</h2>
          {% if current_user.evaluations|list %}
              {% for evaluation in current_user.evaluations %}
              <div class="evaluation-card">
                  <div class="evaluation-badge">
                      <span class="badge {{ evaluation.statut.value }}">
                          {{ evaluation.statut.value }}
                      </span>
                  </div>
                  <div class="evaluation-content">
                      <div class="evaluation-left">
                          <h3 style="color: #333; margin-bottom: 10px; font-family: 'Bubblegum', cursive !important;">
                              Evaluation pour {{ evaluation.flan.nom }}
                              <small style="color: #7f8c8d; font-size: 0.9em; font-weight: normal;">
                                  {{ evaluation.date_creation.strftime('%d/%m/%Y') }}
                              </small>
                          </h3>

                          <div class="evaluation-notes">
                              <div class="note-item">
                                  <p><strong>Visuel:</strong> {{ evaluation.visuel }}/5</p>
                              </div>
                              <div class="note-item">
                                  <p><strong>Texture:</strong> {{ evaluation.texture }}/5</p>
                              </div>
                              <div class="note-item">
                                  <p><strong>Pâte:</strong> {{ evaluation.pate }}/5</p>
                              </div>
                              <div class="note-item">
                                  <p><strong>Goût:</strong> {{ evaluation.gout }}/5</p>
                              </div>
                          </div>

                          <div class="evaluation-moyenne">
                              <strong>Moyenne : {{ "%.1f"|format(evaluation.moyenne) }}/5</strong>
                          </div>

                          <div class="evaluation-comment">
                              <p>{{ evaluation.description or "Aucun commentaire" }}</p>
                          </div>
                      </div>

                      <div class="evaluation-right">
                          {% if evaluation.photo %}
                              <img src="{{ url_for('static', filename='uploads/' + evaluation.photo.path) }}"
                                   alt="Photo de l'évaluation"
                                   class="evaluation-photo">
                          {% else %}
                              <p style="color: #7f8c8d; font-style: italic;">Aucune photo disponible</p>
                          {% endif %}
                      </div>
                  </div>
              </div>
              {% endfor %}
          {% else %}
              <div class="no-evaluations">
                  <i class="fas fa-comment-slash"></i>
                  <p>Aucune évaluation deposée.</p>
              </div>
          {% endif %}
      </div>
  </div>

  <script>
      document.getElementById('edit-profile-btn').addEventListener('click', function() {
          document.getElementById('user-info').style.display = 'none';
          document.getElementById('edit-profile-form').style.display = 'block';
      });
  </script>

{% endblock %}
