{% extends "base.html" %}
{% block content %}
  <div class="container">
      <h1>Tableau de bord</h1>

      <!-- Section Infos Utilisateur -->
      <div id="user-info" class="form-container etablissement-header">
          <p><strong>Pseudo:</strong> {{ current_user.pseudo }}</p>
          <p><strong>Email:</strong> {{ current_user.email }}</p>
          <div style="text-align: right; margin-top: 15px;">
              <button id="edit-profile-btn" class="btn btn-primary">Modifier le profil</button>
              <form method="POST" action="{{ url_for('auth.supprimer_compte') }}" style="display: inline-block; margin-left: 10px;">
                  <button type="submit" class="btn btn-danger">Supprimer le compte</button>
              </form>
          </div>
      </div>

      <!-- Formulaire d'édition du profil (masqué par défaut) -->
      <div id="edit-profile-form" class="form-container" style="display: none; margin-top: 20px;">
          <form method="POST" action="" class="form">
              {{ profile_form.hidden_tag() }}
              <div class="form-group">
                  {{ profile_form.pseudo.label(class="form-label") }}
                  {{ profile_form.pseudo(size=20, class="form-control") }}
                  {% for error in profile_form.pseudo.errors %}
                      <span class="error-message">[{{ error }}]</span>
                  {% endfor %}
              </div>
              <div class="form-group">
                  {{ profile_form.email.label(class="form-label") }}
                  {{ profile_form.email(size=20, class="form-control") }}
                  {% for error in profile_form.email.errors %}
                      <span class="error-message">[{{ error }}]</span>
                  {% endfor %}
              </div>
              <div class="form-group">
                  {{ profile_form.current_password.label(class="form-label") }}
                  {{ profile_form.current_password(size=20, class="form-control") }}
                  {% for error in profile_form.current_password.errors %}
                      <span class="error-message">[{{ error }}]</span>
                  {% endfor %}
              </div>
              <div class="form-group">
                  {{ profile_form.new_password.label(class="form-label") }}
                  {{ profile_form.new_password(size=20, class="form-control") }}
                  {% for error in profile_form.new_password.errors %}
                      <span class="error-message">[{{ error }}]</span>
                  {% endfor %}
              </div>
              <div class="form-group">
                  {{ profile_form.confirm_password.label(class="form-label") }}
                  {{ profile_form.confirm_password(size=20, class="form-control") }}
                  {% for error in profile_form.confirm_password.errors %}
                      <span class="error-message">[{{ error }}]</span>
                  {% endfor %}
              </div>
              <div class="form-group">
                  {{ profile_form.submit(class="btn btn-submit") }}
                  <button id="cancel-edit-btn" type="button" class="btn btn-back" style="margin-left: 10px;">Annuler</button>
              </div>
          </form>
      </div>

      <!-- Section Mes Évaluations -->
      <div class="evaluations-section form-container" style="margin-top: 20px;">
          <h2 class="evaluations-title">Mes evaluations</h2>
          {{ afficher_grille('evaluation', current_user.evaluations, current_user) }}
      </div>

      <!-- Sections Admin (si utilisateur est admin) -->
      {% if current_user.is_admin %}
          <div class="evaluations-section form-container" style="margin-top: 20px;">
              <h2 class="evaluations-title">Evaluations en attente de validation</h2>
              {{ afficher_grille('evaluation', pending_evaluations, current_user) }}
          </div>
          <div class="evaluations-section form-container" style="margin-top: 20px;">
              <h2 class="evaluations-title">Flans en attente de validation</h2>
              {{ afficher_grille('flan', pending_flans, current_user) }}
          </div>
          <div class="evaluations-section form-container" style="margin-top: 20px;">
              <h2 class="evaluations-title">Etablissements en attente de validation</h2>
              {{ afficher_grille('etablissement', pending_etablissements, current_user) }}
          </div>
      {% endif %}
  </div>

  <!-- Script pour basculer entre affichage infos et formulaire -->
  <script>
      document.getElementById('edit-profile-btn').addEventListener('click', function() {
          document.getElementById('user-info').style.display = 'none';
          document.getElementById('edit-profile-form').style.display = 'block';
      });
      document.getElementById('cancel-edit-btn').addEventListener('click', function() {
          document.getElementById('user-info').style.display = 'block';
          document.getElementById('edit-profile-form').style.display = 'none';
      });
  </script>
{% endblock %}
